"use strict";!function(a,i,m){function y(t,e){var i=void 0!==t["fields-data"]["field-types"],n=t["fields-data"].fields;return m.each(e,function(e,a){i?(m.each(t["fields-data"]["field-types"],function(e,t){t.type===a.meta.id&&(n=t.fields)}),m.each(a.values,function(e,t){t.id=n[e].id})):m.each(a.values,function(e,t){t.id=n[e].id})}),e}a.AO=a.AO||{},m(function(){var e=m(".jsAlchemyRepeaterField");if(e[0]){var s=m(i),p=AlchemyRepeatersData["add-repeatee"],o=AlchemyRepeatersData["clone-repeatee"],r=AlchemyRepeatersData.misc,t=new URL(a.location.href),h=t.searchParams.get("page");h=h||t.searchParams.get("post"),e.each(function(e,t){var a=m(t),i=a.children(".field__content").children(".jsAlchemyRepeaterItems"),l=i.children(".jsAlchemyRepeatee").length;a.on("click",".jsAlchemyAddRepeatee",function(e){e.stopPropagation();var t=m(this),a=t.closest(".jsAlchemyRepeaterField"),i=a.data("alchemy"),n=t.data("repeater"),d=a.children(".field__content").children(".jsAlchemyRepeaterItems"),r=new FormData;t.attr("disabled",!0).next(".jsAlchemyRepeaterLoader").removeClass("alchemy__spinner--hidden"),r.append("_wpnonce",p.nonce),r.append("page-id",h),r.append("repeatees-number",++l),r.append("id",i.id),r.append("repeater-id",i["repeater-id"]),n&&n.type&&(r.append("type-id",n.type.id),r.append("type-title",n.type.title)),m.ajax({method:"POST",url:p.url,dataType:"json",processData:!1,contentType:!1,data:r,success:function(e){if(e.success&&e.data){var t=m(e.data),a=t.children(".repeatee__fields").children(".field--editor").find(".jsAlchemyEditor");d.append(t),a[0]&&AO.tinymce.create_editors(a)}},complete:function(){s.click(),t.removeAttr("disabled").next(".jsAlchemyRepeaterLoader").addClass("alchemy__spinner--hidden")}})}),a.on("click",".jsAlchemyRepeateeToolbar",function(e){e.stopPropagation(),s.click();var t=m(this).closest(".repeatee"),a=t.children(".repeatee__fields").children(".field--editor");t.hasClass("repeatee--expanded")?(AO.tinymce.destroy_editors(a.find(".jsAlchemyEditor")),t.removeClass("repeatee--expanded"),a.find(".wp-editor-tools").remove()):(AO.tinymce.create_editors(a.find(".jsAlchemyEditor")),t.addClass("repeatee--expanded"))}),a.on("click",".jsAlchemyRepeateeRemove",function(){var e=m(this).closest(".repeatee");e.fadeOut(function(){e.remove()})}),a.on("click",".jsAlchemyRepeateeAction",function(t){var d=this;t.stopPropagation();var e,a,i,n,r=m(this),c=r.closest(".repeatee");switch(r.data("action")){case"hide":a=r,n=(i=c).data("meta"),a.toggleClass("repeatee__btn--active"),a.find("span").toggleClass("dashicons-visibility").toggleClass("dashicons-hidden"),i.removeAttr("style").toggleClass("repeatee--hidden"),n.visible=void 0!==n.visible&&!n.visible;break;case"clone":!function(){t.stopPropagation();var a=m(d),i=a.closest(".jsAlchemyRepeaterField").data("alchemy"),n=new FormData;a.attr("disabled",!0).next(".jsAlchemyRepeaterLoader").removeClass("alchemy__spinner--hidden"),n.append("_wpnonce",o.nonce),n.append("page-id",h),n.append("repeatees-number",++l),n.append("id",i.id),n.append("repeater-id",i["repeater-id"]);var e=c.children(".repeatee__fields").children(".jsAlchemyField").map(function(e,t){var a=m(t).data("alchemy");return new Function("return AO['get_".concat(a.type,"_value']('").concat(a.id,"');"))(a.id)}).get();Promise.all(e).then(function(e){var t=m.extend({},c.data("meta"));t.label=t.label+" copy",t.title&&t.id&&(n.append("type-id",t.id),n.append("type-title",t.title)),e=y(i,[{meta:t,values:e}]),n.append("values",JSON.stringify(e)),m.ajax({method:"POST",url:o.url,dataType:"json",processData:!1,contentType:!1,data:n,success:function(e){if(e.success&&e.data){var t=m(e.data),a=t.children(".repeatee__fields").children(".field--editor").find(".jsAlchemyEditor");c.after(t),a[0]&&AO.tinymce.create_editors(a)}},complete:function(){s.click(),a.removeAttr("disabled").next(".jsAlchemyRepeaterLoader").addClass("alchemy__spinner--hidden")}})})}();break;case"delete":(e=c).fadeOut(function(){e.remove()})}}),a.on("click",".jsAlchemyRepeaterTypeTrigger",function(e){var t=m(this),a=t.closest(".repeater__add-from-type"),i=t.siblings(".jsAlchemyRepeaterFieldTypes");e.stopPropagation(),a.addClass("repeater__add-new--active"),i.addClass("repeater__field-types--visible"),s.one("click",function(){a.removeClass("repeater__add-new--active"),i.removeClass("repeater__field-types--visible")})}),a.on("click",".jsAlchemyRepeaterFieldTypes",function(e){e.stopPropagation()}),a.on({input:function(){var e=m(this),t=e.closest(".repeatee").data("meta"),a=e.val();t.label=a,e.prev(".jsRepeateeTitleText").text(a)},click:function(e){e.stopPropagation()}},".jsRepeateeTitle"),i.sortable({placeholder:"repeatee--placeholder",opacity:.8,axis:"y",handle:".jsRepeateeDndHandle",start:function(e,t){i.find(".repeatee--placeholder").height(t.helper.height()-2),AO.tinymce.save_editors(m(".jsAlchemyEditor",a))},stop:function(){AO.tinymce.restore_editors(m(".jsAlchemyEditor",a))}}),i.disableSelection();var n=a.find(".jsAlchRepeaterSelect").children("select"),d=r["add-from-type"]?r["add-from-type"]:"Add from type";n.select2({placeholder:d}).on("select2:select",function(e){s.click();var t=m(e.target),a=t.children('[value="'.concat(e.params.data.id,'"]')),i=t.closest(".jsAlchemyRepeaterField"),n=i.data("alchemy"),d=a.data("repeater"),r=i.children(".field__content").children(".jsAlchemyRepeaterItems"),c=new FormData;t.siblings(".jsAlchemyRepeaterLoader").removeClass("alchemy__spinner--hidden"),c.append("_wpnonce",p.nonce),c.append("page-id",h),c.append("repeatees-number",++l),c.append("id",n.id),c.append("repeater-id",n["repeater-id"]),d&&d.type&&(c.append("type-id",d.type.id),c.append("type-title",d.type.title)),m.ajax({method:"POST",url:p.url,dataType:"json",processData:!1,contentType:!1,data:c,success:function(e){if(e.success&&e.data){var t=m(e.data),a=t.children(".repeatee__fields").children(".field--editor").find(".jsAlchemyEditor");r.append(t),a[0]&&AO.tinymce.create_editors(a)}},complete:function(){t.removeAttr("disabled").val("").change().blur().siblings(".jsAlchemyRepeaterLoader").addClass("alchemy__spinner--hidden")}})})})}}),AO.get_repeater_value=function(a){var t=m(".jsAlchemyRepeaterField").filter(function(e,t){return a===m(t).data("alchemy").id}),e=t.children(".field__content").children(".jsAlchemyRepeaterItems").children(".jsAlchemyRepeatee").map(function(e,t){var a=m(t),i=a.data("meta"),n=a.children(".repeatee__fields").children(".jsAlchemyField").map(function(e,t){var a=m(t).data("alchemy");return new Function("return AO['get_".concat(a.type,"_value']('").concat(a.id,"');"))(a.id)}).get();return Promise.all(n).then(function(e){return Promise.resolve({meta:i,values:e})})}).get();return Promise.all(e).then(function(e){return Promise.resolve({type:"repeater:".concat(t.data("alchemy")["repeater-id"]),id:a,value:y(t.data("alchemy"),e)})})}}(window,document,jQuery);
//# sourceMappingURL=scripts.min.js.map